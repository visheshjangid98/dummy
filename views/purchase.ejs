<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Purchase - Trace MC</title>
    <link rel="icon" type="image/png" href="media/favicon.png">
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/purchase.css" />
  </head>
  <body>
    <main class="main-content">
      <div class="purchase-container">
        <div class="purchase-header">
          <h1>Complete Your Purchase</h1>
          <p>You're almost there! Just a few more details needed.</p>
        </div>
        
        <div class="purchase-content">
          <div class="product-info">
            <div class="product-details">
              <h2><%= name %></h2>
              <p><%= desc %></p>
            </div>
            <div class="price-display">
              <span class="price-label">Total:</span>
              <span class="price-amount">â‚¹<%= price %></span>
            </div>
          </div>
          
          <div class="purchase-form-container">
            <form class="purchase-form" action="/confirmation" method="post" novalidate>
              <div class="form-group">
                <label for="mcName" class="form-label">Minecraft Username</label>
                <input
                  type="text"
                  id="mcName"
                  name="mcName"
                  class="form-input"
                  required
                  placeholder="Enter your Minecraft username"
                />
              </div>
              
              <div class="form-group">
                <label for="dcName" class="form-label">Discord Username</label>
                <input
                  type="text"
                  id="dcName"
                  name="dcName"
                  class="form-input"
                  required
                  placeholder="Enter your Discord username"
                />
              </div>
              
              <input type="hidden" name="productId" value="<%= productId %>" />
              
              <div class="checkbox-group">
                <input type="checkbox" id="terms" class="checkbox-input" />
                <label for="terms" class="checkbox-label">
                  I accept the <a href="/terms" target="_blank">terms and conditions</a>
                </label>
              </div>
              
              <button type="button" class="btn btn-primary purchase-btn" onclick="submit_form()">
                Proceed to Payment
              </button>
            </form>
          </div>
        </div>
      </div>
    </main>
    
    <div class="alert alert-error purchase-alert hidden" id="error-alert">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span id="error_msg">Something went wrong</span>
    </div>
    
    <script>
      const errorMsg = document.getElementById("error_msg");
      const errorAlert = document.getElementById("error-alert");
      
      function close() {
        setTimeout(() => {
          errorAlert.classList.add("hidden");
        }, 3000);
      }
      
      function submit_form() {
        const mcName = document.getElementById("mcName").value;
        const dcName = document.getElementById("dcName").value;
        const termsCheckbox = document.getElementById("terms");

        if (!mcName) {
          errorMsg.textContent = "Minecraft Username is required";
          errorAlert.classList.remove("hidden");
          close();
        } else if (!dcName) {
          errorMsg.textContent = "Discord Username is required";
          errorAlert.classList.remove("hidden");
          close();
        } else if (!termsCheckbox.checked) {
          errorMsg.textContent = "You must accept the terms and conditions";
          errorAlert.classList.remove("hidden");
          close();
        } else {
          document.querySelector(".purchase-form").submit();
        }
      }
    </script>
  </body>
</html>