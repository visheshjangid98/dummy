<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trace Mc</title>
    <link rel="icon" type="image/png" href="media/favicon.png">
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/auth.css" />
  </head>
  <body>
    <%- include('components/navbar', { user: null }) %>
    
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <img src="media/logo_small.png" alt="Trace MC" class="auth-logo">
          <h1 class="auth-title">Welcome Back</h1>
          <p class="auth-subtitle">Sign in to your account</p>
        </div>
        
        <form class="auth-form" data-error="<%= err %>" action="/login" method="post" novalidate>
          <div class="form-group">
            <label for="username" class="form-label">Username or Email</label>
            <input
              type="text"
              id="username"
              name="name"
              class="form-input"
              required
              placeholder="Enter your username or email"
            />
          </div>
          
          <div class="form-group">
            <label for="password" class="form-label">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              class="form-input"
              required
              placeholder="Enter your password"
            />
          </div>
          
          <div class="auth-links">
            <a href="/reset" class="auth-link">Forgot Password?</a>
          </div>
          
          <button type="button" class="btn btn-primary auth-submit" onclick="submit_form()">
            Sign In
          </button>
        </form>
        
        <div class="auth-footer">
          <p>Don't have an account? <a href="/signup" class="auth-link">Create one</a></p>
        </div>
      </div>
    </div>
    
    <div class="alert alert-error auth-alert hidden" id="error-alert">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span id="error_msg">Something went wrong</span>
    </div>
    
    <script>
      const errorMsg = document.getElementById("error_msg");
      const errorAlert = document.getElementById("error-alert");
      
      function close() {
        setTimeout(() => {
          errorAlert.classList.add("hidden");
        }, 2000);
      }
      
      function submit_form() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        if (!username) {
          errorMsg.textContent = "Username or email is required";
          errorAlert.classList.remove("hidden");
          close();
        } else if (!password) {
          errorMsg.textContent = "Password is required";
          errorAlert.classList.remove("hidden");
          close();
        } else {
          document.querySelector(".auth-form").submit();
        }
      }
      
      // Page load errors
      window.addEventListener("load", function () {
        const err = document.querySelector(".auth-form").getAttribute("data-error");
        if (err == "error-1") {
          errorMsg.textContent = "Invalid username/email or password";
          errorAlert.classList.remove("hidden");
          close();
        }
      });
    </script>
  </body>
</html>
