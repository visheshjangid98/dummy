<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Confirmation - Trace MC</title>
    <link rel="icon" type="image/png" href="media/favicon.png">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/confirm.css">
</head>
<body>
    <main class="main-content">
        <div class="confirm-container">
            <div class="confirm-header">
                <h1>Payment Confirmation</h1>
                <p>Complete your payment using the QR code below</p>
            </div>
            
            <div class="confirm-content">
                <div class="payment-info">
                    <div class="amount-display">
                        <span class="amount-label">Amount to Pay</span>
                        <span class="amount-value">â‚¹<%= price %></span>
                    </div>
                    
                    <div class="qr-section">
                        <div class="qr-container">
                            <img src="<%= qrCodeImage %>" alt="Payment QR Code" class="qr-code">
                        </div>
                        <p class="qr-instruction">Scan with any UPI app to pay</p>
                    </div>
                    
                    <div class="payment-methods">
                        <img src="media/paymentmethods.png" alt="Supported Payment Methods" class="payment-methods-img">
                    </div>
                </div>
                
                <div class="confirmation-form-container">
                    <form class="confirmation-form" action="/confirmed" method="post" novalidate>
                        <div class="form-group">
                            <label for="txnId" class="form-label">Transaction ID</label>
                            <input
                                type="text"
                                id="txnId"
                                name="TXNId"
                                class="form-input"
                                required
                                placeholder="Enter transaction ID from your payment app"
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmTxnId" class="form-label">Confirm Transaction ID</label>
                            <input
                                type="text"
                                id="confirmTxnId"
                                class="form-input"
                                required
                                placeholder="Re-enter transaction ID to confirm"
                            />
                        </div>
                        
                        <input type="hidden" value="<%= orderId %>" name="orderId">
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="terms" class="checkbox-input">
                            <label for="terms" class="checkbox-label">
                                I confirm that I have completed the payment and accept the <a href="/terms" target="_blank">terms and conditions</a>
                            </label>
                        </div>
                        
                        <button type="button" class="btn btn-primary confirm-btn" onclick="submit_form()">
                            Confirm Payment
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>
    
    <div class="alert alert-error confirm-alert hidden" id="error-alert">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span id="error_msg">Something went wrong</span>
    </div>
    
    <script>
        const errorMsg = document.getElementById("error_msg");
        const errorAlert = document.getElementById("error-alert");
        
        function close() {
            setTimeout(() => {
                errorAlert.classList.add("hidden");
            }, 3000);
        }
        
        function submit_form() {
            const txnId = document.getElementById("txnId").value;
            const confirmTxnId = document.getElementById("confirmTxnId").value;
            const termsCheckbox = document.getElementById("terms");

            if (!txnId) {
                errorMsg.textContent = "Transaction ID is required";
                errorAlert.classList.remove("hidden");
                close();
            } else if (!confirmTxnId) {
                errorMsg.textContent = "Please confirm your transaction ID";
                errorAlert.classList.remove("hidden");
                close();
            } else if (txnId !== confirmTxnId) {
                errorMsg.textContent = "Transaction IDs do not match";
                errorAlert.classList.remove("hidden");
                close();
            } else if (!termsCheckbox.checked) {
                errorMsg.textContent = "You must accept the terms and conditions";
                errorAlert.classList.remove("hidden");
                close();
            } else {
                document.querySelector(".confirmation-form").submit();
            }
        }
    </script>
</body>
</html>